*banana-ast.txt*          For NVIM v0.12.0         Last change: 2025 August 20

==============================================================================
Table of Contents                               *banana-ast-table-of-contents*

  - getData                                               |banana-ast-getdata|
  - setData                                               |banana-ast-setdata|
  - getContext                                         |banana-ast-getcontext|
  - getRootNode                                       |banana-ast-getrootnode|
  - getTagName                                         |banana-ast-gettagname|
  - setInnerNml                                       |banana-ast-setinnernml|
  - hasStyle                                             |banana-ast-hasstyle|
  - assertHasStyle                                 |banana-ast-asserthasstyle|
  - marginLeft                                         |banana-ast-marginleft|
  - marginRight                                       |banana-ast-marginright|
  - marginTop                                           |banana-ast-margintop|
  - marginBottom                                     |banana-ast-marginbottom|
  - paddingLeft                                       |banana-ast-paddingleft|
  - paddingRight                                     |banana-ast-paddingright|
  - paddingTop                                         |banana-ast-paddingtop|
  - paddingBottom                                   |banana-ast-paddingbottom|
  - cloneNode                                           |banana-ast-clonenode|
  - insertBefore                                     |banana-ast-insertbefore|
  - removeChild                                       |banana-ast-removechild|
  - replaceChild                                     |banana-ast-replacechild|
  - firstChild                                         |banana-ast-firstchild|
  - lastChild                                           |banana-ast-lastchild|
  - nextSibling                                       |banana-ast-nextsibling|
  - previousSibling                               |banana-ast-previoussibling|
  - ownerDocument                                   |banana-ast-ownerdocument|
  - clone                                                   |banana-ast-clone|
  - setAttribute                                     |banana-ast-setattribute|
  - getAttributes                                   |banana-ast-getattributes|
  - setStyle                                             |banana-ast-setstyle|
  - setStyleValue                                   |banana-ast-setstylevalue|
  - hasClass                                             |banana-ast-hasclass|
  - removeClass                                       |banana-ast-removeclass|
  - addClass                                             |banana-ast-addclass|
  - toggleClass                                       |banana-ast-toggleclass|
  - getBoundBox                                       |banana-ast-getboundbox|
  - getWidth                                             |banana-ast-getwidth|
  - getHeight                                           |banana-ast-getheight|
  - isNil                                                   |banana-ast-isnil|
  - remove                                                 |banana-ast-remove|
  - getAttribute                                     |banana-ast-getattribute|
  - hasAttribute                                     |banana-ast-hasattribute|
  - appendTextNode                                 |banana-ast-appendtextnode|
  - appendTextNodeNoEscape                 |banana-ast-appendtextnodenoescape|
  - appendChild                                       |banana-ast-appendchild|
  - isLineHovering                                 |banana-ast-islinehovering|
  - isHovering                                         |banana-ast-ishovering|
  - removeChildren                                 |banana-ast-removechildren|
  - children                                             |banana-ast-children|
  - childIterWithI                                 |banana-ast-childiterwithi|
  - allChildIter                                     |banana-ast-allchilditer|
  - childIter                                           |banana-ast-childiter|
  - child                                                   |banana-ast-child|
  - getAttributeSubstitution             |banana-ast-getattributesubstitution|
  - getTextContent                                 |banana-ast-gettextcontent|
  - setTextContent                                 |banana-ast-settextcontent|
  - parent                                                 |banana-ast-parent|
  - isHidden                                             |banana-ast-ishidden|
  - attachRemap                                       |banana-ast-attachremap|
  - Explanation                                       |banana-ast-explanation|
  - Constraints                                       |banana-ast-constraints|
1. Links                                                    |banana-ast-links|
The AST class is the second of two API surfaces that you will use for any
interaction with the dom tree in banana (the other one being Instance).

Not all of the browser api functions are implemented, but what I have now is
hopefully enough for the API to be usable. If there are any missing features of
the browser API that you would really like ported to banana, submit an issue or
a pr.


GETDATA                                                   *banana-ast-getdata*

Returns the data associated with the ast [UNSTABLE]

Functionally, this is a non-string version of get/setAttribute. This is
intended to be used with components to pass data as parameters to them

- **Parameters**:
    - `item` (string?): The name of the data item to get
- **Returns**: `any?` - the value of the data item


SETDATA                                                   *banana-ast-setdata*

Sets the data associated with the array [UNSTABLE]

Functionally, this is a non-string version of get/setAttribute. This is
intended to be used with components to pass data as parameters to them

- **Parameters**:
    - `key` (string): The name of the data item to set
    - `value` (any): the value of the data item


GETCONTEXT                                             *banana-ast-getcontext*

Returns a canvas context that can be used to render. This ONLY returns a valid
context on `<canvas>` elements, otherwise, it returns nil. See canvas rendering
<https://github.com/CWood-sdf/banana.nvim/wiki/Canvas> for more details

- **Returns**: `Banana.Nml.CanvasContext`


GETROOTNODE                                           *banana-ast-getrootnode*

Returns the root node of this section of the DOM tree

In components, this will return a the tag that the component runs inside,
otherwise, it will return the tag

- **Returns**: `Banana.Ast` - The root node


GETTAGNAME                                             *banana-ast-gettagname*

Returns the name of the tag that this ast node is for (eg. 'div')

- **Returns**: `string` - The tag name


SETINNERNML                                           *banana-ast-setinnernml*

Sets the nodelist of this ast to be equivalent to the NML string provided.

note: due to a limitation of the current nml parser, the entire string MUST be
contained inside a single element (eg setInnerNml('asdf idk ') is allowed but
setInnerNml('asdf idk ') is not)

- **Parameters**:
    - `nml` (string): The nml string to set this ast’s content to


HASSTYLE                                                 *banana-ast-hasstyle*

Returns true if the style {style} (eg. 'hl-fg') is in the node’s style list

- **Parameters**:
    - `style` (string): the style to lookup
- **Returns**: `boolean` - True if the style is in the node’s style list


ASSERTHASSTYLE                                     *banana-ast-asserthasstyle*

Throws an error if the style {style} has not been set in the node’s style
list

- **Parameters**:
    - `style` (string): the style to lookup


MARGINLEFT                                             *banana-ast-marginleft*

Returns the actual left side margin of the element (in characters)

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `number`


MARGINRIGHT                                           *banana-ast-marginright*

Returns the actual right side margin of the element (in characters)

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `number`


MARGINTOP                                               *banana-ast-margintop*

Returns the actual top side margin of the element (in characters)

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `number`


MARGINBOTTOM                                         *banana-ast-marginbottom*

Returns the actual bottom side margin of the element (in characters)

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `number`


PADDINGLEFT                                           *banana-ast-paddingleft*

Returns the actual left side padding of the element (in characters)

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `number`


PADDINGRIGHT                                         *banana-ast-paddingright*

Returns the actual right side padding of the element (in characters)

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `number`


PADDINGTOP                                             *banana-ast-paddingtop*

Returns the actual top side padding of the element (in characters)

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `number`


PADDINGBOTTOM                                       *banana-ast-paddingbottom*

Returns the actual bottom side padding of the element (in characters)

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `number`


CLONENODE                                               *banana-ast-clonenode*

Duplicates the ast node to eg allow it to be located in two different places in
the tree.

This is the same function as `ast:clone()`, but is here for dom api
compatibility

note: DOES NOT clone remaps or associated scripts

- **Parameters**:
    - `deep` (boolean?): Whether to also clone the child nodes (default true)
- **Returns**: `Banana.Ast`


INSERTBEFORE                                         *banana-ast-insertbefore*

Adds {child} to this node’s child list right before {referenceNode}

note: if passing string parameters for {child}, there is the possibility that
the same string is located multiple times in the ast’s nodelist, leading to
strange results. there is also the possibility that the string passed for
{child} is not found due to the formatting

- **Parameters**:
    - `child` (Banana.Ast|string): The child in the nodelist to insert before
    - `referenceNode` (Banana.Ast|string): The node to insert into the tree


REMOVECHILD                                           *banana-ast-removechild*

Removes {child} from this node’s child list and then returns it

note: if passing string parameters for {child}, there is the possibility that
the same string is located multiple times in the ast’s nodelist, leading to
strange results. there is also the possibility that the string passed for
{child} is not found due to the formatting

- **Parameters**:
    - `child` (Banana.Ast|string): The node to remove
- **Returns**: `Banana.Ast|string|nil`


REPLACECHILD                                         *banana-ast-replacechild*

Replaces {child} from this node’s child list with {newChild} and then returns
the removed element

note: if passing string parameters for {child}, there is the possibility that
the same string is located multiple times in the ast’s nodelist, leading to
strange results. there is also the possibility that the string passed for
{child} is not found due to the formatting

- **Parameters**:
    - `child` (Banana.Ast|string): The child to replace
    - `newChild` (Banana.Ast|string): The new child to put in place
- **Returns**: `Banana.Ast|string|nil`


FIRSTCHILD                                             *banana-ast-firstchild*

Returns the first child node

- **Parameters**:
    - `allowString` (boolean): whether to include the string nodes (default false)
- **Returns**: `Banana.Ast|string`


LASTCHILD                                               *banana-ast-lastchild*

Returns the last child node

- **Parameters**:
    - `allowString` (boolean): whether to include the string nodes (default false)
- **Returns**: `Banana.Ast|string`


NEXTSIBLING                                           *banana-ast-nextsibling*

Returns the node that comes after this node in the dom order

Returns the nil ast if there is no node after this node

>nml
    <div>
      <div id="1">
        <div id="2">
        </div
      </div>
      <div id="3">
      </div>
    </div>
<

>lua
    document:getElementById('1'):nextSibling() -- returns node 3
    document:getElementById('2'):nextSibling():isNil() -- evals to true
<

- **Parameters**:
    - `allowString` (boolean): whether to include the string nodes
- **Returns**: `Banana.Ast|string`


PREVIOUSSIBLING                                   *banana-ast-previoussibling*

Returns the node that comes before this node in the dom order.

Returns the nil ast if there is no node before this node

>nml
    <div>
      <div id="1">
        <div id="2">
        </div
      </div>
      <div id="3">
      </div>
    </div>
<

>lua
    document:getElementById('3'):previousSibling() -- returns node 1
    document:getElementById('1'):previousSibling():isNil() -- evals to true
<

@overload fun(allowString: true): Banana.Ast|string

- **Parameters**:
    - `allowString` (false?): whether to include the string nodes
- **Returns**: `Banana.Ast`


OWNERDOCUMENT                                       *banana-ast-ownerdocument*

Returns the document that this ast is a part of

- **Returns**: `Banana.Instance`


CLONE                                                       *banana-ast-clone*

Duplicates this node (note: does NOT copy attached events)

- **Parameters**:
    - `deep` (boolean): Whether to clone children too or just this node
- **Returns**: `Banana.Ast`


SETATTRIBUTE                                         *banana-ast-setattribute*

Sets the attribute {name} to {value}

- **Parameters**:
    - `name` (string): the name of the attribute
    - `value` (string): the new value of the attribute


GETATTRIBUTES                                       *banana-ast-getattributes*

Returns a map of all attributes and their string values

>nml
    <div id="1" class="class1 class2">
    </div>
<

>lua
    document:getElementById('1'):getAttributes()
    -- returns { id="1", class="class1 class2"}
    -- or returns { id="1", class="class2 class1"}
<

- **Returns**: `{` - [string]: string}


SETSTYLE                                                 *banana-ast-setstyle*

Sets the elements custom style rules to {value}.

This is the same as calling setAttribute("style", value)

- **Parameters**:
    - `value` (string): the ncss style string to set this element’s style rules to


SETSTYLEVALUE                                       *banana-ast-setstylevalue*

Sets the style declaration for {name} (eg hl-bg) to be {value}

- **Parameters**:
    - `name` (string): the name of the style to set
    - `value` (string): the string of the value


HASCLASS                                                 *banana-ast-hasclass*

Returns true if the node has class {c}

- **Parameters**:
    - `c` (string): the class to find
- **Returns**: `boolean`


REMOVECLASS                                           *banana-ast-removeclass*

Removes the class {c} from the node’s class list

- **Parameters**:
    - `c` (string): the class to unset


ADDCLASS                                                 *banana-ast-addclass*

Adds the class {c} to the node’s class list

- **Parameters**:
    - `c` (string): the class to set


TOGGLECLASS                                           *banana-ast-toggleclass*

Toggles the class {c} to the node’s class list (eg calls addClass(c) if
hasClass(c) is false)

- **Parameters**:
    - `c` (string): the class to toggle


GETBOUNDBOX                                           *banana-ast-getboundbox*

Returns the node’s bounding box (content+padding) in characters

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `Banana.Ast.BoundingBox`


GETWIDTH                                                 *banana-ast-getwidth*

Returns the width of the node’s bounding box (content+padding) in characters

note: this method will return an invalid value on scripts with when="prerender"

- **Returns**: `number`


GETHEIGHT                                               *banana-ast-getheight*

Returns the height of the node’s bounding box (content+padding) in characters

note: this method will return an invalid value on scripts with when="prerender"


ISNIL                                                       *banana-ast-isnil*

Returns true if the node is a nil node

Most functions that may or may not return an ast will return this instead of
nil

A nil node throws an error if any method is called on it

- **Returns**: `boolean`


REMOVE                                                     *banana-ast-remove*

removes the ast node from the dom and deletes ALL associated keymaps


GETATTRIBUTE                                         *banana-ast-getattribute*

Returns the attribute value for {name} or nil if not found

- **Parameters**:
    - `name` (string): the name of the attribute to get
- **Returns**: `string?`


HASATTRIBUTE                                         *banana-ast-hasattribute*

Returns true if this node has attribute {name} set

- **Parameters**:
    - `name` (string): the attribute to search for
- **Returns**: `boolean`


APPENDTEXTNODE                                     *banana-ast-appendtextnode*

Adds {text} to the child list of the node

Escapes the text if it starts with an & or %

>nml
    <span id="1">asdf</span>
<

>lua
    -- "1" renders as `asdf` right now
    document:getElementById("1"):appendTextNode("text")
    -- "1" will now render as `asdftext`
    document:getElementById("1"):appendTextNode("%asdf")
    -- "1" will now render as `asdftext%asdf`
<

- **Parameters**:
    - `text` (string): the text to add to the node


APPENDTEXTNODENOESCAPE                     *banana-ast-appendtextnodenoescape*

Adds {text} to the child list of the node

Does NOT escape the text

>nml
    <span id="1">asdf</span>
<

>lua
    -- "1" renders as `asdf` right now
    document:getElementById("1"):appendTextNodeNoEscape("&lt;")
    -- "1" will now render as `asdf<`
<

- **Parameters**:
    - `text` (string): the text to add to the node


APPENDCHILD                                           *banana-ast-appendchild*

Adds ast {node} as a child to this node

note: if you add a block element (eg `<div>`) as a descendant of an inline
element (eg `<span>`) you will get a LineTooBig error when trying to render

note: {node} CANNOT be a string

- **Parameters**:
    - `node` (Banana.Ast): the node to append as a child


ISLINEHOVERING                                     *banana-ast-islinehovering*

Returns true if the cursor is on the same line as this node

- **Returns**: `boolean`


ISHOVERING                                             *banana-ast-ishovering*

Returns true if the cursor is hovering over this ast

- **Returns**: `boolean`


REMOVECHILDREN                                     *banana-ast-removechildren*

Removes all children from this node (including text)


CHILDREN                                                 *banana-ast-children*

Returns all ast node children of this element (not text nodes)

- **Returns**: `Banana.Ast[]`


CHILDITERWITHI                                     *banana-ast-childiterwithi*

Returns an iterator that allows iteration over all ast children with indexing

>lua
    for i, v in ast:childIterWithI() do
    end
<

- **Returns**: `fun(): number?, Banana.Ast?`


ALLCHILDITER                                         *banana-ast-allchilditer*

Returns an iterator over all the children of this node (including text)

- **Returns**: `fun():(Banana.Ast|string)?`


CHILDITER                                               *banana-ast-childiter*

Returns an iterator over all the ast children of this node

- **Returns**: `fun():Banana.Ast?`


CHILD                                                       *banana-ast-child*

Returns the nth non-string child of this node

- **Returns**: `Banana.Ast`


GETATTRIBUTESUBSTITUTION                 *banana-ast-getattributesubstitution*

returns what the attribute substitution (eg %attr in nml) would be for {name}

>nml
    <div name="idk">
      <span id="1">%name</span> <!-- renders as "idk" -->
    </div>
<

>lua
    document:getElementById("1"):getAttributeSubstitution("name") -- returns "idk"
<

- **Parameters**:
    - `name` (string): the attribute to lookup
- **Returns**: `string?`


GETTEXTCONTENT                                     *banana-ast-gettextcontent*

Returns the printed text value of this element (does not include newlines)

Note: This is currently bugged as entities (eg &) and attr substitutions (eg
%attr) will not return their printed value

- **Returns**: `string`


SETTEXTCONTENT                                     *banana-ast-settextcontent*

Sets the text content of this element. Removes all other children

Replaces newlines with elements (note: if newlines are passed inside an inline
element (eg. ), it will cause a LineTooBig error)

- **Parameters**:
    - `str` (string): the text to set this element’s content to


PARENT                                                     *banana-ast-parent*

Returns the parent node of this node

- **Returns**: `Banana.Ast`


ISHIDDEN                                                 *banana-ast-ishidden*

Returns true when this node is not rendered (eg the style `display: none`)

- **Returns**: `boolean`


ATTACHREMAP                                           *banana-ast-attachremap*

Attaches the given remap to the ast


EXPLANATION                                           *banana-ast-explanation*

For those wondering why one should not just use `vim.keymap.set` there are a
few reasons.

1. Remap collision. `vim.keymap.set` can only set one remap per buffer which means that if you want multiple ast nodes to handle remaps differently (eg in mason when you try to install a package pressing `i` on different lines installs different packages) you have to have a central function handle everything. `attachRemap` allows "decentralized" remaps (ie each ast node can figure out how to best handle the remap)
2. Remap deletion. Remembering to delete remap handlers when an ast is deleted can be annoying. Using `attachRemap` does that for you


CONSTRAINTS                                           *banana-ast-constraints*

Currently, the supported constraints are "hover", "line-hover", and <number>.

>lua
    -- this will only be called if the cursor is over the node (eg isHovering() is true)
    -- when the user types `<leader>w` or if the user types `1<leader>w`
    ast:attachRemap("n", "<leader>w", { "hover", 1 }, function()
    
    end, {})
<

Line-hover is similar to hover except that it calls the remap if the cursor is
on the same line as the ast node (eg isLineHovering() is true), instead of
strictly hovering over it

- **Parameters**:
    - `mode` (string): the mode of the keymap
    - `lhs` (string): the lhs of the keymap
    - `mods` (Banana.Remap.Constraint[]): a list of remap constraints
    - `rhs` (string|fun()): callback
    - `opts` (vim.keymap.set.Opts?): keymap options

==============================================================================
1. Links                                                    *banana-ast-links*

1. *@overload*: 

Generated by panvimdoc <https://github.com/kdheepak/panvimdoc>

vim:tw=78:ts=8:noet:ft=help:norl:
